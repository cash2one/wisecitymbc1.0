(function(a){a.getUrlParam=function(b){var c=new RegExp("(^|&)"+b+"=([^&]*)(&|$)");var d=window.location.search.substr(1).match(c);if(d!=null){return unescape(d[2])}return null};a.getAnchor=function(){return window.location.hash}})(jQuery);emptyFunc=function(a){return a};function JsonToStr(c){if(c===undefined){return""}var b=[];if(typeof c==="string"){return'"'+c.replace(/([\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"'}if(typeof c==="object"){if(!c.sort){for(var a in c){b.push('"'+a+'":'+JsonToStr(c[a]))}if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(c.toString)){b.push("toString:"+c.toString.toString())}b="{"+b.join()+"}"}else{for(var a=0;a<c.length;a++){b.push(JsonToStr(c[a]))}b="["+b.join()+"]"}return b}return c.toString().replace(/\"\:/g,'":""')}window.encodeJSON=JSON.stringify||JsonToStr;window.decodeJSON=JSON.parse||function(a){return Function("return "+a)()};Object.clone=function(a){if(typeof a!=="object"){return a}var c={};if(a.constructor==Array){c=[]}for(var b in a){c[b]=Object.clone(a[b])}return c};Object.extend=function(c,a){for(var b in a){if(typeof a[b]!=="object"){c[b]=a[b]}else{if(a[b]&&a[b].constructor==Array){c[b]=Object.clone(a[b])}else{c[b]=c[b]||{};Object.extend(c[b],a[b])}}}};String.prototype.render=function(a){return this.replace(/{([^{}]+)}/g,function(e){var f=e.slice(1,-1).split("."),d=a;for(var c=0,b=f.length;c<b;c++){d=d[f[c]];if(d===undefined||d===null){return""}}return d})};$.fn.serializeObject=function(){var c={},b=this.serializeArray();$.each(b,function(){var a=this.hasOwnProperty("value")?this.value:"";if(typeof c[this.name]==="Array"){c[this.name].append(a)}else{(c[this.name]===undefined)?c[this.name]=a:c[this.name]=[c[this.name],a]}});return c};$.fn.error=function(){var a=$(this);a.addClass("blank").one("keypress",function(){$(this).removeClass("blank")}).focus()};$.fn.captcha=function(){var a=$(this);if(a.is("img")){function b(){a.attr("src","/captcha/")}b();a.click(b)}else{if(a.is("form")){a.find("img").captcha()}}};$.fn.clearForm=function(){$(":input","#"+$(this).attr("id")).not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected").removeClass("blank").find("div.alert-login").hide()};$.fn.placeError=function(a){if(!this.is("form")){return this}this.find("div.alert-login").addClass("visible").html(a.html&&a.html()||a);return this};$.fn.errors=function(b){if(!this.is("form")){return this}for(var a in b){$("input[name='"+a+"']").error();this.placeError(b[a])}return this};(function(){function b(d,e,f){if(typeof e==="object"){e=encodeJSON(e)}return $.ajax({url:d,type:f,contentType:"application/json",data:e,dataType:"json"})}function c(d,e,f,g){this.type=f?f:"action";this.name=d;this.noSupport=[];this.params=Object.clone(g)||{};this._url=(e||"/api/")+d+"/"}c.prototype.param=function(){var d={};if(arguments.length===1){d=arguments[0]}else{d[arguments[0]]=arguments[1]}typeof d==="object"&&Object.extend(this.params,d);return this};c.prototype.url=function(d){if(this.hasOwnProperty(d)){return this[d]}return this[d]=new c(d,this._url)};c.prototype.id=function(d){return new c(d,this._url,"id")};methods=["get","post","delete","patch"];for(var a=0;a<methods.length;a++){(function(d){c.prototype[d]=function(f){var k={404:"notFound",403:"forbidden",400:"paramError",405:"methodNotAllowed",420:"captchaError",200:"ok"},h={};if(this.type==="raw"){this.paramStr=""}else{var e=[];for(var g in this.params){e.push(g+"="+this.params[g])}this.paramStr="?"+encodeURI(e.join("&"))}var l={};for(var g in k){if(g!=200){(function(i){l[i]=function(o){h[i].fire(decodeJSON(o.responseText))}})(g)}}var n=this,j=b(this._url+this.paramStr,f,d).statusCode(l).done(function(i){h[200].fire(i)});for(var g in k){var m=h[g]=$.Callbacks("once memory");j[k[g]]=m.add}return j}})(methods[a])}window.API={url:function(d){return this[d]?this[d]:this[d]=new c(d)},raw:function(d){var e=new c("",d,"raw");e._url=d;return e},list:function(e){function g(p,o){if(o===null){p.hide()}else{p.show().data("url",o)}}function h(p){var o=[];g(f,p.next);g(d,p.previous);$(p.results).each(function(){var q=this;i(q);o.push(l.render(q))});m.html("");$(o.join("")).appendTo(m)}function n(){API.raw($(this).data("url")).get().ok(h)}function j(){k.get().ok(h)}var k=e.apiUrl,f=$("#"+e.next),d=$("#"+e.prev),m=$("#"+e.container),i=e.processData||emptyFunc,l=e.template||"";f.click(n).hide();d.click(n).hide();j();return j}}})();$.validator.setDefaults({debug:true,onfocusout:false,onkeyup:false,onclick:false,errorPlacement:function(a,b){b.error();var c=b;while(!c.is("form")){c=c.parent()}c.placeError(a)}});$.validator.addMethod("gt",function(b,a,c){if(typeof c==="string"&&c[0]==="#"){c=parseFloat($(a.form).find("[name="+c.slice(1)+"]").val())}return this.optional(a)||parseFloat(b)>c},$.validator.format("输入的数值必须大于{0}"));$.validator.addMethod("lt",function(b,a,c){if(typeof c==="string"&&c[0]==="#"){c=parseFloat($(a.form).find("[name="+c.slice(1)+"]").val())
}return this.optional(a)||parseFloat(b)<c},$.validator.format("输入的数值必须小于{0}"));$.fn.initForm=function(a){if(!(this.is("form"))){return}this.data("callback",a.callback||{});this.data("processData",a.processData||emptyFunc)};$(function(){$("form.mese").each(function(){function j(o){return"col-sm-"+o}var n=$(this).addClass("form-horizontal"),l=n.attr("captcha")!==undefined,f=parseInt(n.attr("input-width"))||9,k=j(f),d=j(12-f),e=n.find("input, select, textarea").not(":submit"),h=n.find("input[type=submit]"),i=h.length;if(l){var g=$("<input>").addClass("form-control").attr({name:"captcha",type:"text"});$("<div/>").addClass(k).append($('<div class="col-sm-4"></div>').addClass("no-padding").append(g)).append($("<div/>").addClass("col-sm-8").append($("<img title='看不清？点击换一张'/>").addClass("captcha"))).wrap($("<div/>").addClass("form-group")).parent().prepend($("<label>验证码</div>").addClass("control-label "+d)).insertBefore(h.first());n.captcha()}$("<div/>").addClass("alert alert-danger alert-login").wrap('<div class="form-group"></div>').insertBefore(h.first());var m={};e.each(function(){var q=$(this).addClass("form-control"),o=q.data(),p={};$((q.attr("validator")||"").split(" ")).each(function(){if(this.indexOf(":")>=0){var r=this.split(":"),s=isNaN(parseFloat(r[1]))?r[1]:parseFloat(r[1]);p[r[0]]=s}else{if(this.length){p[this]=true}}});m[q.attr("name")]=p;q.wrap($("<div/>").addClass(k)).parent().wrap($("<div/>").addClass("form-group")).before($("<label>{label}</div>".render(o)).addClass("control-label "+d))});n.validate({rules:m});h.wrapAll('<div class="form-group"/>').each(function(){var o=$(this);o.addClass("btn btn-login").wrap($("<div/>").addClass(j(Math.round(12/i))))});if(i===1){n.submit(function(){n.validate();if(!n.valid()){return false}var o=n.data("processData")||emptyFunc,q=n.serializeObject(),s=n.data("callback")||emptyFunc,r=n.attr("method")||"post",p=n.attr("action");o(q),$submit=n.find("input[type=submit]");$submit.button("loading");API.raw(p)[r](q).ok(function(t){n.clearForm();s(t);$submit.button("reset")}).paramError(function(t){n.errors(t);$submit.button("reset")}).captchaError(function(){g.error();$submit.button("reset")})})}else{h.click(function(){var r=$(this),q=r.attr("action"),t=n.attr("method")||"post";n.validate();if(!n.valid()){return false}var o=n.data("processData")||emptyFunc,p=n.serializeObject(),s=n.data("callback");s=s?s[r.attr("name")]:emptyFunc;o(p);r.button("loading");API.raw(q)[t](p).ok(function(u){n.clearForm();s(u);r.button("reset")}).paramError(function(u){n.errors(u);r.button("reset")}).captchaError(function(){g.error();r.button("reset")})})}$(".btn-mese2014, .btn-login").attr("data-loading-text","请稍候...")});var c=[];function a(d){if(d.getDayOfYear()===(new Date()).getDayOfYear()){this.setOptions({minTime:0})}else{this.setOptions({minTime:undefined})}}for(var b=8;b<24;b++){c.push(b+":00")}$("input.time").mask("99:99");$("input.datetime").datetimepicker({format:"Y-m-d H:i:s",minDate:0,lang:"ch",allowTimes:c,showSeconds:true})});window.tips=function(a){toastr.success(a,"提示",{timeOut:3000})};
