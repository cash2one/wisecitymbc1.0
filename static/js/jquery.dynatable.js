(function(h){var n,c,u,o,t={dom:b,domColumns:y,records:j,recordsCount:f,processingIndicator:a,state:p,sorts:z,sortsHeaders:e,queries:m,inputsSearch:i,paginationPage:s,paginationPerPage:d,paginationLinks:k},v,w,r,A,B,x,g,q;n={features:{paginate:true,sort:true,pushState:true,search:true,recordCount:true,perPageSelect:true},table:{defaultColumnIdStyle:"camelCase",columns:null,headRowSelector:"thead tr",bodyRowSelector:"tbody tr",headRowClass:null},inputs:{queries:null,sorts:null,multisort:["ctrlKey","shiftKey","metaKey"],page:null,queryEvent:"blur change",recordCountTarget:null,recordCountPlacement:"after",paginationLinkTarget:null,paginationLinkPlacement:"after",paginationClass:"dynatable-pagination-links",paginationLinkClass:"dynatable-page-link",paginationPrevClass:"dynatable-page-prev",paginationNextClass:"dynatable-page-next",paginationActiveClass:"dynatable-active-page",paginationDisabledClass:"dynatable-disabled-page",paginationPrev:"Previous",paginationNext:"Next",paginationGap:[1,2,2,1],searchTarget:null,searchPlacement:"before",perPageTarget:null,perPagePlacement:"before",perPageText:"Show: ",recordCountPageBoundTemplate:"{pageLowerBound} to {pageUpperBound} of",recordCountPageUnboundedTemplate:"{recordsShown} of",recordCountTotalTemplate:"{recordsQueryCount} {collectionName}",recordCountFilteredTemplate:" (filtered from {recordsTotal} total records)",recordCountText:"Showing",recordCountTextTemplate:"{text} {pageTemplate} {totalTemplate} {filteredTemplate}",recordCountTemplate:'<span id="dynatable-record-count-{elementId}" class="dynatable-record-count">{textTemplate}</span>',processingText:"Processing..."},dataset:{ajax:false,ajaxUrl:null,ajaxCache:null,ajaxOnLoad:false,ajaxMethod:"GET",ajaxDataType:"json",totalRecordCount:null,queries:{},queryRecordCount:null,page:null,perPageDefault:10,perPageOptions:[10,20,50,100],sorts:{},sortsKeys:null,sortTypes:{},records:null},writers:{_rowWriter:B,_cellWriter:x,_attributeWriter:g},readers:{_rowReader:null,_attributeReader:q},params:{dynatable:"dynatable",queries:"queries",sorts:"sorts",page:"page",perPage:"perPage",offset:"offset",records:"records",record:null,queryRecordCount:"queryRecordCount",totalRecordCount:"totalRecordCount"}};u={init:function(D,C){this.settings=c(C);this.element=D;this.$element=h(D);w.call(this);return this},process:function(C){r.call(this,C)}};c=function(C){var D=h.extend(true,{},n,C);if(C){if(C.inputs){if(C.inputs.multisort){D.inputs.multisort=C.inputs.multisort}if(C.inputs.paginationGap){D.inputs.paginationGap=C.inputs.paginationGap}}if(C.dataset&&C.dataset.perPageOptions){D.dataset.perPageOptions=C.dataset.perPageOptions}}return D};w=function(){this.$element.trigger("dynatable:preinit",this);for(model in t){if(t.hasOwnProperty(model)){var C=this[model]=new t[model](this,this.settings);if(C.initOnLoad()){C.init()}}}this.$element.trigger("dynatable:init",this);if(!this.settings.dataset.ajax||(this.settings.dataset.ajax&&this.settings.dataset.ajaxOnLoad)||this.settings.features.paginate){this.process()}};r=function(C){var G={};this.$element.trigger("dynatable:beforeProcess",G);if(!h.isEmptyObject(this.settings.dataset.queries)){G[this.settings.params.queries]=this.settings.dataset.queries}this.processingIndicator.show();if(this.settings.features.sort&&!h.isEmptyObject(this.settings.dataset.sorts)){G[this.settings.params.sorts]=this.settings.dataset.sorts}if(this.settings.features.paginate&&this.settings.dataset.page){var F=this.settings.dataset.page,E=this.settings.dataset.perPage;G[this.settings.params.page]=F;G[this.settings.params.perPage]=E;G[this.settings.params.offset]=(F-1)*E}if(this.settings.dataset.ajaxData){h.extend(G,this.settings.dataset.ajaxData)}if(this.settings.dataset.ajax){var H=this;var D={type:H.settings.dataset.ajaxMethod,dataType:H.settings.dataset.ajaxDataType,data:G,error:function(J,I){},success:function(I){H.$element.trigger("dynatable:ajax:success",I);H.records.updateFromJson(I);H.dom.update();if(!C&&H.state.initOnLoad()){H.state.push(G)}},complete:function(){H.processingIndicator.hide()}};if(this.settings.dataset.ajaxUrl){D.url=this.settings.dataset.ajaxUrl}else{D.url=v.refreshQueryString(window.location.href,{},this.settings)}if(this.settings.dataset.ajaxCache!==null){D.cache=this.settings.dataset.ajaxCache}h.ajax(D)}else{this.records.resetOriginal();this.queries.run();if(this.settings.features.sort){this.records.sort()}if(this.settings.features.paginate){this.records.paginate()}this.dom.update();this.processingIndicator.hide();if(!C&&this.state.initOnLoad()){this.state.push(G)}}this.$element.trigger("dynatable:afterProcess",G)};function B(I,D,F,H){var G="";for(var E=0,C=F.length;E<C;E++){G+=H(F[E],D)}return"<tr>"+G+"</tr>"}function x(E,C){var D=E.attributeWriter(C),F="<td";if(E.hidden||E.textAlign){F+=' style="';if(E.hidden){F+="display: none;"}if(E.textAlign){F+="text-align: "+E.textAlign+";"}F+='"'}return F+">"+D+"</td>"}function g(C){return C[this.id]}function q(C,D){return h(C).html()}o={initOnLoad:function(){return true},init:function(){}};for(model in t){if(t.hasOwnProperty(model)){var l=t[model];l.prototype=o}}function b(D,C){var E=this;this.update=function(){var Q="",I=C.table.columns,K=C.writers._rowWriter,G=C.writers._cellWriter;D.$element.trigger("dynatable:beforeUpdate",Q);for(var J=0,N=C.dataset.records.length;J<N;J++){var L=C.dataset.records[J],O=K(J,L,I,G);Q+=O}if(C.features.recordCount){h("#dynatable-record-count-"+D.element.id).replaceWith(D.recordsCount.create())}if(C.features.paginate){h("#dynatable-pagination-links-"+D.element.id).replaceWith(D.paginationLinks.create());if(C.features.perPageSelect){h("#dynatable-per-page-"+D.element.id).val(parseInt(C.dataset.perPage))}}if(C.features.sort&&I){D.sortsHeaders.removeAllArrows();for(var J=0,N=I.length;J<N;J++){var H=I[J],M=v.allMatch(C.dataset.sorts,H.sorts,function(S,R){return R in S}),P=C.dataset.sorts[H.sorts[0]];if(M){D.$element.find('[data-dynatable-column="'+H.id+'"]').find(".dynatable-sort-header").each(function(){if(P==1){D.sortsHeaders.appendArrowUp(h(this))}else{D.sortsHeaders.appendArrowDown(h(this))}})}}}if(C.inputs.queries||C.features.search){var F=C.inputs.queries||h();if(C.features.search){F=F.add("#dynatable-query-search-"+D.element.id)}F.each(function(){var S=h(this),R=C.dataset.queries[S.data("dynatable-query")];S.val(R||"")})}D.$element.find(C.table.bodyRowSelector).remove();D.$element.append(Q);D.$element.trigger("dynatable:afterUpdate",Q)}}function y(D,C){var E=this;this.initOnLoad=function(){return D.$element.is("table")};this.init=function(){C.table.columns=[];this.getFromTable()};this.getFromTable=function(){var F=D.$element.find(C.table.headRowSelector).children("th,td");if(F.length){F.each(function(G){E.add(h(this),G,true)})}else{return h.error("Couldn't find any columns headers in '"+C.table.headRowSelector+" th,td'. If your header row is different, specify the selector in the table: headRowSelector option.")}};this.add=function(R,K,N,F){var H=C.table.columns,Q=R.text(),G=R.data("dynatable-column")||v.normalizeText(Q,C.table.defaultColumnIdStyle),P=R.data("dynatable-sorts"),J=P?h.map(P.split(","),function(T){return h.trim(T)}):[G];if(!G){this.generate(R);G=R.data("dynatable-column")}H.splice(K,0,{index:K,label:Q,id:G,attributeWriter:C.writers[G]||C.writers._attributeWriter,attributeReader:C.readers[G]||C.readers._attributeReader,sorts:J,hidden:R.css("display")==="none",textAlign:R.css("text-align")});R.attr("data-dynatable-column",G).addClass("dynatable-head");if(C.table.headRowClass){R.addClass(C.table.headRowClass)}if(!N){var O=K+1,M=D.$element.find(C.table.headRowSelector).children("th:nth-child("+O+"),td:nth-child("+O+")").first(),S=H.slice(K+1,H.length);if(M.length){M.before(R)}else{D.$element.find(C.table.headRowSelector).append(R)}D.sortsHeaders.attachOne(R.get());if(S.length){for(var I=0,L=S.length;I<L;I++){S[I].index+=1}}if(!F){D.dom.update()}}return u};this.remove=function(J){var G=C.table.columns,I=G.length;if(typeof(J)==="number"){var H=G[J];this.removeFromTable(H.id);this.removeFromArray(J)}else{for(var F=G.length-1;F>=0;F--){var H=G[F];if(H.id===J){this.removeFromTable(J);this.removeFromArray(F)}}}D.dom.update()};this.removeFromTable=function(F){D.$element.find(C.table.headRowSelector).children('[data-dynatable-column="'+F+'"]').first().remove()};this.removeFromArray=function(G){var I=C.table.columns,J;I.splice(G,1);J=I.slice(G,I.length);for(var H=0,F=J.length;H<F;H++){J[H].index-=1}};this.generate=function(G){var F=G===undefined?h("<th></th>"):G;return this.attachGeneratedAttributes(F)};this.attachGeneratedAttributes=function(G){var F=D.$element.find(C.table.headRowSelector).children("th[data-dynatable-generated]").length;return G.attr("data-dynatable-column","dynatable-generated-"+F).attr("data-dynatable-no-sort","true").attr("data-dynatable-generated",F)}}function j(D,C){var E=this;this.initOnLoad=function(){return !C.dataset.ajax};this.init=function(){if(C.dataset.records===null){C.dataset.records=this.getFromTable();if(!C.dataset.queryRecordCount){C.dataset.queryRecordCount=this.count()}if(!C.dataset.totalRecordCount){C.dataset.totalRecordCount=C.dataset.queryRecordCount}}C.dataset.originalRecords=h.extend(true,[],C.dataset.records)};this.updateFromJson=function(I){var G;if(C.params.records==="_root"){G=I}else{if(C.params.records in I){G=I[C.params.records]}}if(C.params.record){var F=G.length-1;for(var H=0;H<F;H++){G[H]=G[H][C.params.record]}}if(C.params.queryRecordCount in I){C.dataset.queryRecordCount=I[C.params.queryRecordCount]}if(C.params.totalRecordCount in I){C.dataset.totalRecordCount=I[C.params.totalRecordCount]}C.dataset.records=G};this.sort=function(){var H=[].sort,I=C.dataset.sorts,G=C.dataset.sortsKeys,J=C.dataset.sortTypes;var F=function(N,M){var P;if(h.isEmptyObject(I)){P=D.sorts.functions["originalPlacement"](N,M)}else{for(var O=0,L=G.length;O<L;O++){var K=G[O],Q=I[K],R=J[K]||D.sorts.guessType(N,M,K);P=D.sorts.functions[R](N,M,K,Q);if(P!==0){break}}}return P};return H.call(C.dataset.records,F)};this.paginate=function(){var G=this.pageBounds(),H=G[0],F=G[1];C.dataset.records=C.dataset.records.slice(H,F)};this.resetOriginal=function(){C.dataset.records=C.dataset.originalRecords||[]};this.pageBounds=function(){var G=C.dataset.page||1,H=(G-1)*C.dataset.perPage,F=Math.min(H+C.dataset.perPage,C.dataset.queryRecordCount);return[H,F]};this.getFromTable=function(){var F=[],G=C.table.columns,H=D.$element.find(C.table.bodyRowSelector);H.each(function(J){var I={};I["dynatable-original-index"]=J;h(this).find("th,td").each(function(L){if(G[L]===undefined){D.domColumns.add(D.domColumns.generate(),G.length,false,true)}var M=G[L].attributeReader(this,I),K=G[L].id;if(typeof(M)==="string"&&M.match(/\s*\<.+\>/)){if(!I["dynatable-sortable-text"]){I["dynatable-sortable-text"]={}}I["dynatable-sortable-text"][K]=h.trim(h("<div></div>").html(M).text())}I[K]=M});if(typeof(C.readers._rowReader)==="function"){C.readers._rowReader(J,this,I)}F.push(I)});return F};this.count=function(){return C.dataset.records.length}}function f(D,C){this.initOnLoad=function(){return C.features.recordCount};this.init=function(){this.attach()};this.create=function(){var E="",G="",F={elementId:D.element.id,recordsShown:D.records.count(),recordsQueryCount:C.dataset.queryRecordCount,recordsTotal:C.dataset.totalRecordCount,collectionName:C.params.records,text:C.inputs.recordCountText};if(C.features.paginate){if(F.recordsShown<F.recordsQueryCount){var H=D.records.pageBounds();F.pageLowerBound=H[0]+1;F.pageUpperBound=H[1];E=C.inputs.recordCountPageBoundTemplate}else{if(F.recordsShown===F.recordsQueryCount){E=C.inputs.recordCountPageUnboundedTemplate}}}if(F.recordsQueryCount<F.recordsTotal){G=C.inputs.recordCountFilteredTemplate}F.pageTemplate=v.template(E,F);F.filteredTemplate=v.template(G,F);F.totalTemplate=v.template(C.inputs.recordCountTotalTemplate,F);F.textTemplate=v.template(C.inputs.recordCountTextTemplate,F);return v.template(C.inputs.recordCountTemplate,F)};this.attach=function(){var E=C.inputs.recordCountTarget?h(C.inputs.recordCountTarget):D.$element;E[C.inputs.recordCountPlacement](this.create())}}function a(D,C){this.init=function(){this.attach()};this.create=function(){var E=h("<div></div>",{html:"<span>"+C.inputs.processingText+"</span>",id:"dynatable-processing-"+D.element.id,"class":"dynatable-processing",style:"position: absolute; display: none;"});return E};this.position=function(){var J=h("#dynatable-processing-"+D.element.id),G=J.children("span"),H=G.outerHeight(),F=G.outerWidth(),L=D.$element,K=L.offset(),E=L.outerHeight(),I=L.outerWidth();J.offset({left:K.left,top:K.top}).width(I).height(E);G.offset({left:K.left+((I-F)/2),top:K.top+((E-H)/2)});return J};this.attach=function(){D.$element.before(this.create())};this.show=function(){h("#dynatable-processing-"+D.element.id).show();this.position()};this.hide=function(){h("#dynatable-processing-"+D.element.id).hide()}}function p(D,C){this.initOnLoad=function(){return C.features.pushState&&history.pushState};this.init=function(){window.onpopstate=function(E){if(E.state&&E.state.dynatable){D.state.pop(E)}}};this.push=function(I){var G=window.location.search,N,P,F,H,K,L,E,J=!(window.history.state&&window.history.state.dynatable),O=J?"replaceState":"pushState";if(G&&/^\?/.test(G)){G=G.substring(1)}h.extend(N,I);F=v.refreshQueryString(G,I,C);if(F){F="?"+F}H=window.location.hash;P=window.location.pathname;D.$element.trigger("dynatable:push",I);E={dynatable:{dataset:C.dataset}};if(!J){E.dynatable.scrollTop=h(window).scrollTop()}L=JSON.stringify(E);E.dynatable.dataset.perPageOptions=h.makeArray(E.dynatable.dataset.perPageOptions);try{window.history[O](E,"Dynatable state",P+F+H)}catch(M){E.dynatable.dataset.records=null;window.history[O](E,"Dynatable state",P+F+H)}};this.pop=function(E){var F=E.state.dynatable;C.dataset=F.dataset;if(F.scrollTop){h(window).scrollTop(F.scrollTop)}if(F.dataset.records){D.dom.update()}else{D.process(true)}}}function z(D,C){this.initOnLoad=function(){return C.features.sort};this.init=function(){var E=window.location.search.match(new RegExp(C.params.sorts+"[^&=]*=[^&]*","g"));C.dataset.sorts=E?v.deserialize(E)[C.params.sorts]:{};C.dataset.sortsKeys=E?v.keysFromObject(C.dataset.sorts):[]};this.add=function(E,H){var F=C.dataset.sortsKeys,G=h.inArray(E,F);C.dataset.sorts[E]=H;if(G===-1){F.push(E)}return u};this.remove=function(E){var F=C.dataset.sortsKeys,G=h.inArray(E,F);delete C.dataset.sorts[E];if(G!==-1){F.splice(G,1)}return u};this.clear=function(){C.dataset.sorts={};C.dataset.sortsKeys.length=0};this.guessType=function(G,F,E){var H={string:"string",number:"number","boolean":"number",object:"number"},J=G[E]?typeof(G[E]):typeof(F[E]),I=H[J]||"number";return I};this.functions={number:function(G,F,E,H){return G[E]===F[E]?0:(H>0?G[E]-F[E]:F[E]-G[E])},string:function(G,F,E,K){var J=(G["dynatable-sortable-text"]&&G["dynatable-sortable-text"][E])?G["dynatable-sortable-text"][E]:G[E],H=(F["dynatable-sortable-text"]&&F["dynatable-sortable-text"][E])?F["dynatable-sortable-text"][E]:F[E],I;J=J.toLowerCase();H=H.toLowerCase();I=J===H?0:(K>0?J>H:H>J);return I===false?-1:(I-0)},originalPlacement:function(F,E){return F["dynatable-original-index"]-E["dynatable-original-index"]}}}function e(D,C){var E=this;this.initOnLoad=function(){return C.features.sort};this.init=function(){this.attach()};this.create=function(F){var I=h(F),G=h("<a></a>",{"class":"dynatable-sort-header",href:"#",html:I.html()}),J=I.data("dynatable-column"),H=v.findObjectInArray(C.table.columns,{id:J});G.bind("click",function(K){E.toggleSort(K,G,H);D.process();K.preventDefault()});if(this.sortedByColumn(G,H)){if(this.sortedByColumnValue(H)==1){this.appendArrowUp(G)}else{this.appendArrowDown(G)}}return G};this.removeAll=function(){D.$element.find(C.table.headRowSelector).children("th,td").each(function(){E.removeAllArrows();E.removeOne(this)})};this.removeOne=function(F){var I=h(F),G=I.find(".dynatable-sort-header");if(G.length){var H=G.html();G.remove();I.html(I.html()+H)}};this.attach=function(){D.$element.find(C.table.headRowSelector).children("th,td").each(function(){E.attachOne(this)})};this.attachOne=function(F){var G=h(F);if(!G.data("dynatable-no-sort")){G.html(this.create(F))}};this.appendArrowUp=function(F){this.removeArrow(F);F.append("<span class='dynatable-arrow'> &#9650;</span>")};this.appendArrowDown=function(F){this.removeArrow(F);F.append("<span class='dynatable-arrow'> &#9660;</span>")};this.removeArrow=function(F){F.find(".dynatable-arrow").remove()};this.removeAllArrows=function(){D.$element.find(".dynatable-arrow").remove()};this.toggleSort=function(L,H,J){var G=this.sortedByColumn(H,J),K=this.sortedByColumnValue(J);if(!C.inputs.multisort||!v.anyMatch(L,C.inputs.multisort,function(M,N){return L[N]})){this.removeAllArrows();D.sorts.clear()}if(G){if(K==1){for(var I=0,F=J.sorts.length;I<F;I++){D.sorts.add(J.sorts[I],-1)}this.appendArrowDown(H)}else{for(var I=0,F=J.sorts.length;I<F;I++){D.sorts.remove(J.sorts[I])}this.removeArrow(H)}}else{for(var I=0,F=J.sorts.length;I<F;I++){D.sorts.add(J.sorts[I],1)}this.appendArrowUp(H)}};this.sortedByColumn=function(F,G){return v.allMatch(C.dataset.sorts,G.sorts,function(I,H){return H in I})};this.sortedByColumnValue=function(F){return C.dataset.sorts[F.sorts[0]]}}function m(D,C){var E=this;this.initOnLoad=function(){return C.inputs.queries||C.features.search};this.init=function(){var F=window.location.search.match(new RegExp(C.params.queries+"[^&=]*=[^&]*","g"));C.dataset.queries=F?v.deserialize(F)[C.params.queries]:{};if(C.dataset.queries===""){C.dataset.queries={}}if(C.inputs.queries){this.setupInputs()}};this.add=function(F,G){if(C.features.paginate){C.dataset.page=1}C.dataset.queries[F]=G;return u};this.remove=function(F){delete C.dataset.queries[F];return u};this.run=function(){for(query in C.dataset.queries){if(C.dataset.queries.hasOwnProperty(query)){var G=C.dataset.queries[query];if(E.functions[query]===undefined){var F=v.findObjectInArray(C.table.columns,{id:query});if(F){E.functions[query]=function(H,I){return H[query]==I}}else{h.error("Query named '"+query+"' called, but not defined in queries.functions");continue}}C.dataset.records=h.map(C.dataset.records,function(H){return E.functions[query](H,G)?H:null})}}C.dataset.queryRecordCount=D.records.count()};this.runSearch=function(F){var G=h.extend({},C.dataset.queries);if(F){this.add("search",F)}else{this.remove("search")}if(!v.objectsEqual(C.dataset.queries,G)){D.process()}};this.setupInputs=function(){C.inputs.queries.each(function(){var I=h(this),G=I.data("dynatable-query-event")||C.inputs.queryEvent,H=I.data("dynatable-query")||I.attr("name")||this.id,F=function(K){var J=h(this).val();if(J===""){J=undefined}if(J===C.dataset.queries[H]){return false}if(J){E.add(H,J)}else{E.remove(H)}D.process();K.preventDefault()};I.attr("data-dynatable-query",H).bind(G,F).bind("keypress",function(J){if(J.which==13){F.call(this,J)}});if(C.dataset.queries[H]){I.val(decodeURIComponent(C.dataset.queries[H]))}})};this.functions={search:function(F,G){var H=false;for(attr in F){if(F.hasOwnProperty(attr)){var I=F[attr];if(typeof(I)==="string"&&I.toLowerCase().indexOf(G.toLowerCase())!==-1){H=true;break}else{continue}}}return H}}}function i(D,C){var E=this;this.initOnLoad=function(){return C.features.search};this.init=function(){this.attach()};this.create=function(){var G=h("<input />",{type:"search",id:"dynatable-query-search-"+D.element.id,"data-dynatable-query":"search",value:C.dataset.queries.search}),F=h("<span></span>",{id:"dynatable-search-"+D.element.id,"class":"dynatable-search",text:"Search: "}).append(G);G.bind(C.inputs.queryEvent,function(){D.queries.runSearch(h(this).val())}).bind("keypress",function(H){if(H.which==13){D.queries.runSearch(h(this).val());H.preventDefault()}});return F};this.attach=function(){var F=C.inputs.searchTarget?h(C.inputs.searchTarget):D.$element;F[C.inputs.searchPlacement](this.create())}}function s(D,C){this.initOnLoad=function(){return C.features.paginate};this.init=function(){var E=window.location.search.match(new RegExp(C.params.page+"=([^&]*)"));if(E&&C.features.pushState){this.set(E[1])}else{this.set(1)}};this.set=function(E){C.dataset.page=parseInt(E,10)}}function d(D,C){var E=this;this.initOnLoad=function(){return C.features.paginate};this.init=function(){var F=window.location.search.match(new RegExp(C.params.perPage+"=([^&]*)"));if(F&&C.features.pushState){this.set(F[1],true)}else{this.set(C.dataset.perPageDefault,true)}if(C.features.perPageSelect){this.attach()}};this.create=function(){var G=h("<select>",{id:"dynatable-per-page-"+D.element.id,"class":"dynatable-per-page-select"});for(var H=0,F=C.dataset.perPageOptions.length;H<F;H++){var J=C.dataset.perPageOptions[H],I=C.dataset.perPage==J?'selected="selected"':"";G.append('<option value="'+J+'" '+I+">"+J+"</option>")}G.bind("change",function(K){E.set(h(this).val());D.process()});return h("<span />",{"class":"dynatable-per-page"}).append("<span class='dynatable-per-page-label'>"+C.inputs.perPageText+"</span>").append(G)};this.attach=function(){var F=C.inputs.perPageTarget?h(C.inputs.perPageTarget):D.$element;F[C.inputs.perPagePlacement](this.create())};this.set=function(G,F){if(!F){D.paginationPage.set(1)}C.dataset.perPage=parseInt(G)}}function k(D,C){var E=this;this.initOnLoad=function(){return C.features.paginate};this.init=function(){this.attach()};this.create=function(){var M='<ul id="'+"dynatable-pagination-links-"+D.element.id+'" class="'+C.inputs.paginationClass+'">',O=C.inputs.paginationLinkClass,F=C.inputs.paginationActiveClass,T=C.inputs.paginationDisabledClass,J=Math.ceil(C.dataset.queryRecordCount/C.dataset.perPage),N=C.dataset.page,P=[C.inputs.paginationGap[0],C.dataset.page-C.inputs.paginationGap[1],C.dataset.page+C.inputs.paginationGap[2],(J+1)-C.inputs.paginationGap[3]];M+="<li><span>Pages: </span></li>";for(var L=1;L<=J;L++){if((L>P[0]&&L<P[1])||(L>P[2]&&L<P[3])){continue}else{var S=D.paginationLinks.buildLink(L,L,O,N==L,F),I,H;I=h.inArray(L,P);H=P[I+1];if(I>0&&L!==1&&H&&H>(L+1)){var G='<li><span class="dynatable-page-break">&hellip;</span></li>';S=I<2?G+S:S+G}if(C.inputs.paginationPrev&&L===1){var Q=D.paginationLinks.buildLink(N-1,C.inputs.paginationPrev,O+" "+C.inputs.paginationPrevClass,N===1,T);S=Q+S}if(C.inputs.paginationNext&&L===J){var R=D.paginationLinks.buildLink(N+1,C.inputs.paginationNext,O+" "+C.inputs.paginationNextClass,N===J,T);S+=R}M+=S}}M+="</ul>";var K="#dynatable-pagination-links-"+D.element.id+" a."+O+":not(."+F+",."+T+")";h(document).undelegate(K,"click.dynatable");h(document).delegate(K,"click.dynatable",function(U){$this=h(this);$this.closest(C.inputs.paginationClass).find("."+F).removeClass(F);$this.addClass(F);D.paginationPage.set($this.data("dynatable-page"));D.process();U.preventDefault()});return M};this.buildLink=function(K,H,J,G,L){var I="<a data-dynatable-page="+K+' class="'+J,F="<li";if(G){I+=" "+L;F+=' class="'+L+'"'}I+='">'+H+"</a>";F+=">"+I+"</li>";return F};this.attach=function(){var F=C.inputs.paginationLinkTarget?h(C.inputs.paginationLinkTarget):D.$element;F[C.inputs.paginationLinkPlacement](D.paginationLinks.create())}}v=u.utility={normalizeText:function(D,C){D=this.textTransform[C](D);return D},textTransform:{trimDash:function(C){return C.replace(/^\s+|\s+$/g,"").replace(/\s+/g,"-")},camelCase:function(C){C=this.trimDash(C);return C.replace(/(\-[a-zA-Z])/g,function(D){return D.toUpperCase().replace("-","")}).replace(/([A-Z])([A-Z]+)/g,function(D,F,E){return F+E.toLowerCase()}).replace(/^[A-Z]/,function(D){return D.toLowerCase()})},dashed:function(C){C=this.trimDash(C);return this.lowercase(C)},underscore:function(C){C=this.trimDash(C);return this.lowercase(C.replace(/(-)/g,"_"))},lowercase:function(C){return C.replace(/([A-Z])/g,function(D){return D.toLowerCase()})}},deserialize:function(I){if(!I){return{}}if(typeof(I)==="object"){I=I.join("&")}var F={},H=I.split("&");for(var G=0;G<H.length;G++){var E=H[G].split("="),D=decodeURIComponent(E[0]),K,C;if(!E[1]){continue}K=decodeURIComponent(E[1].replace(/\+/g," "));while(C=D.match(/([^&=]+)\[([^&=]+)\]$/)){var J=K;D=C[1];K={};if(C[2].substr(C[2].length-2)=="]["){K[C[2].substr(0,C[2].length-2)]=[J]}else{K[C[2]]=J}}if(typeof F[D]==="undefined"){if(D.substr(D.length-2)!="[]"){F[D]=K}else{F[D]=[K]}}else{if(typeof F[D]==="string"){F[D]=K}else{if(typeof F[D]==="object"){F[D]=h.extend({},F[D],K)}else{F[D].push(K)}}}}return F},refreshQueryString:function(E,H,D){var J=this,C=E.split("?"),O=C.shift(),L;L=this.deserialize(E);for(K in D.params){if(D.params.hasOwnProperty(K)){var M=D.params[K];if((!D.features.sort&&K=="sorts")||(!D.features.paginate&&J.anyMatch(K,["page","perPage","offset"],function(P,Q){return P==Q}))){continue}if((K==="page"||K==="offset")&&H["page"]===1){if(L[M]){delete L[M]}continue}if(K==="perPage"&&H[M]==D.dataset.perPageDefault){if(L[M]){delete L[M]}continue}if(K=="queries"&&H[M]){var G=D.inputs.queries||[],N=h.makeArray(G.map(function(){return h(this).attr("name")}));if(D.features.search){N.push("search")}for(var F=0,I=N.length;F<I;F++){var K=N[F];if(H[M][K]){if(typeof L[M]==="undefined"){L[M]={}}L[M][K]=H[M][K]}else{delete L[M][K]}}continue}if(H[M]){L[M]=H[M]}else{delete L[M]}}}return decodeURI(h.param(L))},keysFromObject:function(E){var D=[];for(var C in E){D.push(C)}return D},findObjectInArray:function(I,F){var H=this,G;for(var D=0,C=I.length;D<C;D++){var E=I[D];if(H.allMatch(E,F,function(K,J,L){return K[J]==L})){G=E;break}}return G},allMatch:function(E,F,G){var D=true,C=h.isArray(F);h.each(F,function(I,J){var H=C?G(E,J):G(E,I,J);if(!H){return D=false}});return D},anyMatch:function(E,F,G){var D=false,C=h.isArray(F);h.each(F,function(I,J){var H=C?G(E,J):G(E,I,J);if(H){D=true;return false}});return D},objectsEqual:function(D,C){for(attr in D){if(D.hasOwnProperty(attr)){if(!C.hasOwnProperty(attr)||D[attr]!==C[attr]){return false}}}for(attr in C){if(C.hasOwnProperty(attr)&&!D.hasOwnProperty(attr)){return false}}return true},randomHash:function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)},template:function(D,C){return D.replace(/{(\w*)}/g,function(E,F){return C.hasOwnProperty(F)?C[F]:""})}};if(typeof Object.create!=="function"){Object.create=function(D){function C(){}C.prototype=D;return new C()}}h.dynatableSetup=function(C){n=c(C)};h.dynatable=function(C){h.fn["dynatable"]=function(D){return this.each(function(){if(!h.data(this,"dynatable")){h.data(this,"dynatable",Object.create(C).init(this,D))}})}};h.dynatable(u)})(jQuery);
